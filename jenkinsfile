def gv

pipeline {
    agent any

    parameters{
            booleanParam(name: 'boolParam', defaultValue: true)
            choice(name: 'selChoice', choices: ['1.0.1','1.0.2'])
        }
    tools {
        // Install the Maven version configured as "M3" and add it to the path.
        jdk 'JAVA_HOME'
        maven "MAVEN"
    }


    stages {

        stage('Init'){
            steps{
               script{
                    gv =load "Vars/Script.groovy"
               }
            }
        }
        stage('Build') {
            steps {
                // Get some code from a GitHub repository
                git url: 'https://github.com/Sushanta121/book-keeping.git', branch: 'main'

                // Run Maven on a Unix agent.
                //bat "mvn -Dmaven.test.failure.ignore=true clean package"
		bat "mvn -Dmaven.test.failure.ignore=true clean deploy site-deploy -DcljTestReports=true -P shade -Drun.static.analysis_plugin.plugin.phase=none -Drun.essential.static.analysis.plugin.phase=none -DskipReleaseTests=true"

                // To run Maven on a Windows agent, use
                // bat "mvn -Dmaven.test.failure.ignore=true clean package"
            }
        }
        stage('Release Cut'){
                when{
                    expression{params.boolParam==true}
                }
                steps {
                    script {
                        /*
                        def tagName="T1.0.${env.BUILD_NUMBER}"
                        def tagMsg="Release Tag ${env.BUILD_NUMBER}"
                        withCredentials([string(credentialsId: 'git-secret-id', variable: 'TOKEN')]

                            ) {
                            bat """
                                git config user.email "jenkins@ci.com"
                                git config user.name "jenkins"

                                git remote set-url origin https://$TOKEN@github.com/Sushanta121/book-keeping.git

                                git checkout main
                                git pull origin main

                                git tag -a ${tagName} -m "${tagMsg}"
                                git push origin ${tagName}
                            """


                        }*/
                        gv.ReleaseCut()
                    }
                }
            }
        }
    }
